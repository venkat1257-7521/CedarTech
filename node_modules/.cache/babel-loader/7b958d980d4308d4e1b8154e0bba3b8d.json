{"ast":null,"code":"/**\n * [Chart.PieceLabel.js]{@link https://github.com/emn178/Chart.PieceLabel.js}\n *\n * @version 0.15.0\n * @author Chen, Yi-Cyuan [emn178@gmail.com]\n * @copyright Chen, Yi-Cyuan 2017-2018\n * @license MIT\n */\n(function () {\n  if (typeof Chart === 'undefined') {\n    console.warn('Can not find Chart object.');\n    return;\n  }\n\n  if (!Array.isArray) {\n    Array.isArray = function (obj) {\n      return Object.prototype.toString.call(obj) === '[object Array]';\n    };\n  }\n\n  function PieceLabel() {\n    this.drawDataset = this.drawDataset.bind(this);\n  }\n\n  PieceLabel.prototype.beforeDatasetsUpdate = function (chartInstance, index) {\n    this.parseOptions(chartInstance, index);\n\n    if (this.position === 'outside') {\n      var padding = this.fontSize * 1.5 + this.outsidePadding;\n      chartInstance.chartArea.top += padding;\n      chartInstance.chartArea.bottom -= padding;\n    }\n  };\n\n  PieceLabel.prototype.afterDatasetsDraw = function (chartInstance, index) {\n    this.parseOptions(chartInstance, index);\n    this.labelBounds = [];\n    chartInstance.config.data.datasets.forEach(this.drawDataset);\n  };\n\n  PieceLabel.prototype.drawDataset = function (dataset) {\n    var ctx = this.ctx;\n    var chartInstance = this.chartInstance;\n\n    var meta = dataset._meta[Object.keys(dataset._meta)[0]];\n\n    this.totalPercentage = 0;\n    this.total = null;\n\n    for (var i = 0; i < meta.data.length; i++) {\n      var element = meta.data[i],\n          view = element._view,\n          text;\n\n      if (!this.shouldRenderData(view)) {\n        continue;\n      }\n\n      switch (this.render) {\n        case 'value':\n          var value = dataset.data[i];\n\n          if (this.format) {\n            value = this.format(value);\n          }\n\n          text = value.toString();\n          break;\n\n        case 'label':\n          text = chartInstance.config.data.labels[i];\n          break;\n\n        case 'image':\n          text = this.images[i] ? this.loadImage(this.images[i]) : '';\n          break;\n\n        case 'percentage':\n        default:\n          percentage = this.getPercentage(view, dataset, i);\n          text = percentage + '%';\n          break;\n      }\n\n      if (typeof this.render === 'function') {\n        text = this.render({\n          label: chartInstance.config.data.labels[i],\n          value: dataset.data[i],\n          percentage: percentage,\n          dataset: dataset,\n          index: i\n        });\n\n        if (text === null || text === undefined) {\n          text = '';\n        } else if (typeof text === 'object') {\n          text = this.loadImage(text);\n        } else {\n          text = text.toString();\n        }\n      }\n\n      if (!text) {\n        continue;\n      }\n\n      ctx.save();\n      ctx.beginPath();\n      ctx.font = Chart.helpers.fontString(this.fontSize, this.fontStyle, this.fontFamily);\n      var position,\n          innerRadius,\n          arcOffset = 0;\n\n      if (this.position === 'outside' || this.position === 'border') {\n        innerRadius = view.outerRadius / 2;\n        var rangeFromCentre,\n            offset = this.fontSize + this.textMargin,\n            centreAngle = view.startAngle + (view.endAngle - view.startAngle) / 2;\n\n        if (this.position === 'border') {\n          rangeFromCentre = (view.outerRadius - innerRadius) / 2 + innerRadius;\n        } else if (this.position === 'outside') {\n          if (!this.arc) {\n            offset = this.textMargin;\n          }\n\n          rangeFromCentre = view.outerRadius - innerRadius + innerRadius + offset;\n        }\n\n        position = {\n          x: view.x + Math.cos(centreAngle) * rangeFromCentre,\n          y: view.y + Math.sin(centreAngle) * rangeFromCentre\n        };\n\n        if (this.position === 'outside') {\n          if (!this.arc) {\n            offset += this.measureText(text).width / 2;\n          }\n\n          if (position.x < view.x) {\n            position.x -= offset;\n          } else {\n            position.x += offset;\n          }\n\n          arcOffset = view.outerRadius + offset;\n        }\n      } else {\n        innerRadius = view.innerRadius;\n        position = element.tooltipPosition();\n      }\n\n      var fontColor = this.fontColor;\n\n      if (typeof fontColor === 'function') {\n        fontColor = fontColor({\n          label: chartInstance.config.data.labels[i],\n          value: dataset.data[i],\n          percentage: percentage,\n          text: text,\n          backgroundColor: dataset.backgroundColor[i],\n          dataset: dataset,\n          index: i\n        });\n      } else if (typeof fontColor !== 'string') {\n        fontColor = fontColor[i] || this.options.defaultFontColor;\n      }\n\n      if (this.arc) {\n        if (!arcOffset) {\n          arcOffset = (innerRadius + view.outerRadius) / 2;\n        }\n\n        ctx.fillStyle = fontColor;\n        ctx.textBaseline = 'middle';\n        this.drawArcText(text, arcOffset, view, this.overlap);\n      } else {\n        var drawable,\n            mertrics = this.measureText(text),\n            left = position.x - mertrics.width / 2,\n            right = position.x + mertrics.width / 2,\n            top = position.y - mertrics.height / 2,\n            bottom = position.y + mertrics.height / 2;\n\n        if (this.overlap) {\n          drawable = true;\n        } else if (this.position === 'outside') {\n          drawable = this.checkTextBound(left, right, top, bottom);\n        } else {\n          drawable = element.inRange(left, top) && element.inRange(left, bottom) && element.inRange(right, top) && element.inRange(right, bottom);\n        }\n\n        if (drawable) {\n          this.fillText(text, position, fontColor);\n        }\n      }\n\n      ctx.restore();\n    }\n  };\n\n  PieceLabel.prototype.shouldRenderData = function (view) {\n    //Skips label creation if value is zero and showZero is set\n    return this.chartInstance.config.type === 'polarArea' ? view.outerRadius !== 0 : view.circumference !== 0 || this.showZero;\n  };\n\n  PieceLabel.prototype.getPercentage = function (view, dataset, index) {\n    var percentage;\n\n    if (this.chartInstance.config.type === 'polarArea') {\n      if (this.total === null) {\n        this.total = 0;\n\n        for (var i = 0; i < dataset.data.length; ++i) {\n          this.total += dataset.data[i];\n        }\n      }\n\n      percentage = dataset.data[index] / this.total * 100;\n    } else {\n      percentage = view.circumference / this.options.circumference * 100;\n    }\n\n    percentage = parseFloat(percentage.toFixed(this.precision));\n\n    if (!this.showActualPercentages) {\n      this.totalPercentage += percentage;\n\n      if (this.totalPercentage > 100) {\n        percentage -= this.totalPercentage - 100; // After adjusting the percentage, need to trim the numbers after decimal points again, otherwise it may not show\n        // on chart due to very long number after decimal point.\n\n        percentage = parseFloat(percentage.toFixed(this.precision));\n      }\n    }\n\n    return percentage;\n  };\n\n  PieceLabel.prototype.parseOptions = function (chartInstance, index) {\n    var pieceLabel = chartInstance.options.pieceLabel;\n\n    if (Array.isArray(pieceLabel)) {\n      pieceLabel = pieceLabel[index];\n    }\n\n    this.chartInstance = chartInstance;\n    this.ctx = chartInstance.chart.ctx;\n    this.options = chartInstance.config.options;\n    this.render = pieceLabel.render || pieceLabel.mode;\n    this.position = pieceLabel.position || 'default';\n    this.arc = pieceLabel.arc;\n    this.format = pieceLabel.format;\n    this.precision = pieceLabel.precision || 0;\n    this.fontSize = pieceLabel.fontSize || this.options.defaultFontSize;\n    this.fontColor = pieceLabel.fontColor || this.options.defaultFontColor;\n    this.fontStyle = pieceLabel.fontStyle || this.options.defaultFontStyle;\n    this.fontFamily = pieceLabel.fontFamily || this.options.defaultFontFamily;\n    this.shadowOffsetX = pieceLabel.shadowOffsetX || 3;\n    this.shadowOffsetY = pieceLabel.shadowOffsetY || 3;\n    this.shadowColor = pieceLabel.shadowColor || 'rgba(0,0,0,0.3)';\n    this.shadowBlur = pieceLabel.shadowBlur || 6;\n    this.textShadow = pieceLabel.textShadow || false;\n    this.hasTooltip = chartInstance.tooltip._active && chartInstance.tooltip._active.length;\n    this.showZero = pieceLabel.showZero;\n    this.overlap = pieceLabel.overlap;\n    this.images = pieceLabel.images || [];\n    this.outsidePadding = pieceLabel.outsidePadding || 2;\n    this.textMargin = pieceLabel.textMargin || 2;\n    this.showActualPercentages = pieceLabel.showActualPercentages || false;\n  };\n\n  PieceLabel.prototype.checkTextBound = function (left, right, top, bottom) {\n    var labelBounds = this.labelBounds;\n\n    for (var i = 0; i < labelBounds.length; ++i) {\n      var bound = labelBounds[i];\n      var potins = [[left, top], [left, bottom], [right, top], [right, bottom]];\n\n      for (var j = 0; j < potins.length; ++j) {\n        var x = potins[j][0];\n        var y = potins[j][1];\n\n        if (x >= bound.left && x <= bound.right && y >= bound.top && y <= bound.bottom) {\n          return false;\n        }\n      }\n\n      potins = [[bound.left, bound.top], [bound.left, bound.bottom], [bound.right, bound.top], [bound.right, bound.bottom]];\n\n      for (var j = 0; j < potins.length; ++j) {\n        var x = potins[j][0];\n        var y = potins[j][1];\n\n        if (x >= left && x <= right && y >= top && y <= bottom) {\n          return false;\n        }\n      }\n    }\n\n    labelBounds.push({\n      left: left,\n      right: right,\n      top: top,\n      bottom: bottom\n    });\n    return true;\n  };\n\n  PieceLabel.prototype.measureText = function (text) {\n    if (typeof text === 'object') {\n      return {\n        width: text.width,\n        height: text.height\n      };\n    } else {\n      var width = 0;\n      var lines = text.split('\\n');\n\n      for (var i = 0; i < lines.length; ++i) {\n        var result = this.ctx.measureText(lines[i]);\n\n        if (result.width > width) {\n          width = result.width;\n        }\n      }\n\n      return {\n        width: width,\n        height: this.fontSize * lines.length\n      };\n    }\n  };\n\n  PieceLabel.prototype.fillText = function (text, position, fontColor) {\n    var ctx = this.ctx;\n\n    if (typeof text === 'object') {\n      ctx.drawImage(text, position.x - text.width / 2, position.y - text.height / 2, text.width, text.height);\n    } else {\n      ctx.save();\n      ctx.fillStyle = fontColor;\n      ctx.textBaseline = 'top';\n      ctx.textAlign = 'center';\n\n      if (this.textShadow) {\n        ctx.shadowOffsetX = this.shadowOffsetX;\n        ctx.shadowOffsetY = this.shadowOffsetY;\n        ctx.shadowColor = this.shadowColor;\n        ctx.shadowBlur = this.shadowBlur;\n      }\n\n      var lines = text.split('\\n');\n\n      for (var i = 0; i < lines.length; i++) {\n        var y = position.y - this.fontSize / 2 * lines.length + this.fontSize * i;\n        ctx.fillText(lines[i], position.x, y);\n      }\n\n      ctx.restore();\n    }\n  };\n\n  PieceLabel.prototype.loadImage = function (obj) {\n    var image = new Image();\n    image.src = obj.src;\n    image.width = obj.width;\n    image.height = obj.height;\n    return image;\n  };\n\n  PieceLabel.prototype.drawArcText = function (str, radius, view, overlap) {\n    var ctx = this.ctx,\n        centerX = view.x,\n        centerY = view.y,\n        startAngle = view.startAngle,\n        endAngle = view.endAngle;\n    ctx.save();\n    ctx.translate(centerX, centerY);\n    ctx.textAlign = 'left';\n    var angleSize = endAngle - startAngle;\n    startAngle += Math.PI / 2;\n    endAngle += Math.PI / 2;\n    var origStartAngle = startAngle;\n    var mertrics = this.measureText(str);\n    startAngle += (endAngle - (mertrics.width / radius + startAngle)) / 2;\n\n    if (!overlap && endAngle - startAngle > angleSize) {\n      ctx.restore();\n      return;\n    }\n\n    if (typeof str === 'string') {\n      ctx.rotate(startAngle);\n      var lines = str.split('\\n'),\n          max = 0,\n          widths = [],\n          offset = 0;\n\n      if (this.position === 'border') {\n        offset = (lines.length - 1) * this.fontSize / 2;\n      }\n\n      for (var j = 0; j < lines.length; ++j) {\n        var mertrics = ctx.measureText(lines[j]);\n\n        if (mertrics.width > max) {\n          max = mertrics.width;\n        }\n\n        widths.push(mertrics.width);\n      }\n\n      for (var j = 0; j < lines.length; ++j) {\n        var line = lines[j];\n        var y = (lines.length - 1 - j) * -this.fontSize + offset;\n        ctx.save();\n        var padding = (max - widths[j]) / 2;\n        ctx.rotate(padding / radius);\n\n        for (var i = 0; i < line.length; i++) {\n          var char = line.charAt(i);\n          mertrics = ctx.measureText(char);\n          ctx.save();\n          ctx.translate(0, -1 * radius);\n          ctx.fillText(char, 0, y);\n          ctx.restore();\n          ctx.rotate(mertrics.width / radius);\n        }\n\n        ctx.restore();\n      }\n    } else {\n      ctx.rotate((origStartAngle + endAngle) / 2);\n      ctx.translate(0, -1 * radius);\n      this.fillText(str, {\n        x: 0,\n        y: 0\n      });\n    }\n\n    ctx.restore();\n  };\n\n  function init(chartInstance) {\n    if (chartInstance.options.pieceLabel) {\n      var count = 1;\n\n      if (Array.isArray(chartInstance.options.pieceLabel)) {\n        count = chartInstance.options.pieceLabel.length;\n      }\n\n      if (!chartInstance.pieceLabel || count !== chartInstance.pieceLabel.length) {\n        chartInstance.pieceLabel = [];\n\n        for (var i = 0; i < count; ++i) {\n          chartInstance.pieceLabel.push(new PieceLabel());\n        }\n      }\n    } else if (chartInstance.pieceLabel) {\n      delete chartInstance.pieceLabel;\n    }\n\n    return chartInstance.pieceLabel;\n  }\n\n  function execute(chartInstance, method) {\n    if (init(chartInstance)) {\n      for (var i = 0; i < chartInstance.pieceLabel.length; ++i) {\n        chartInstance.pieceLabel[i][method](chartInstance, i);\n      }\n    }\n  }\n\n  Chart.pluginService.register({\n    name: 'PieceLabel',\n    beforeDatasetsUpdate: function beforeDatasetsUpdate(chartInstance) {\n      execute(chartInstance, 'beforeDatasetsUpdate');\n    },\n    afterDatasetsDraw: function afterDatasetsDraw(chartInstance) {\n      execute(chartInstance, 'afterDatasetsDraw');\n    }\n  });\n})();","map":{"version":3,"sources":["/Users/venkat/Desktop/black-dashboard-react/node_modules/chart.piecelabel.js/src/Chart.PieceLabel.js"],"names":["Chart","console","warn","Array","isArray","obj","Object","prototype","toString","call","PieceLabel","drawDataset","bind","beforeDatasetsUpdate","chartInstance","index","parseOptions","position","padding","fontSize","outsidePadding","chartArea","top","bottom","afterDatasetsDraw","labelBounds","config","data","datasets","forEach","dataset","ctx","meta","_meta","keys","totalPercentage","total","i","length","element","view","_view","text","shouldRenderData","render","value","format","labels","images","loadImage","percentage","getPercentage","label","undefined","save","beginPath","font","helpers","fontString","fontStyle","fontFamily","innerRadius","arcOffset","outerRadius","rangeFromCentre","offset","textMargin","centreAngle","startAngle","endAngle","arc","x","Math","cos","y","sin","measureText","width","tooltipPosition","fontColor","backgroundColor","options","defaultFontColor","fillStyle","textBaseline","drawArcText","overlap","drawable","mertrics","left","right","height","checkTextBound","inRange","fillText","restore","type","circumference","showZero","parseFloat","toFixed","precision","showActualPercentages","pieceLabel","chart","mode","defaultFontSize","defaultFontStyle","defaultFontFamily","shadowOffsetX","shadowOffsetY","shadowColor","shadowBlur","textShadow","hasTooltip","tooltip","_active","bound","potins","j","push","lines","split","result","drawImage","textAlign","image","Image","src","str","radius","centerX","centerY","translate","angleSize","PI","origStartAngle","rotate","max","widths","line","char","charAt","init","count","execute","method","pluginService","register","name"],"mappings":"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","sourcesContent":["/**\n * [Chart.PieceLabel.js]{@link https://github.com/emn178/Chart.PieceLabel.js}\n *\n * @version 0.15.0\n * @author Chen, Yi-Cyuan [emn178@gmail.com]\n * @copyright Chen, Yi-Cyuan 2017-2018\n * @license MIT\n */\n(function () {\n  if (typeof Chart === 'undefined') {\n    console.warn('Can not find Chart object.');\n    return;\n  }\n\n  if (!Array.isArray) {\n    Array.isArray = function (obj) {\n      return Object.prototype.toString.call(obj) === '[object Array]';\n    };\n  }\n\n  function PieceLabel() {\n    this.drawDataset = this.drawDataset.bind(this);\n  }\n\n  PieceLabel.prototype.beforeDatasetsUpdate = function (chartInstance, index) {\n    this.parseOptions(chartInstance, index);\n    if (this.position === 'outside') {\n      var padding = this.fontSize * 1.5 + this.outsidePadding;\n      chartInstance.chartArea.top += padding;\n      chartInstance.chartArea.bottom -= padding;\n    }\n  };\n\n  PieceLabel.prototype.afterDatasetsDraw = function (chartInstance, index) {\n    this.parseOptions(chartInstance, index);\n    this.labelBounds = [];\n    chartInstance.config.data.datasets.forEach(this.drawDataset);\n  };\n\n  PieceLabel.prototype.drawDataset = function (dataset) {\n    var ctx = this.ctx;\n    var chartInstance = this.chartInstance;\n    var meta = dataset._meta[Object.keys(dataset._meta)[0]];\n    this.totalPercentage = 0;\n    this.total = null;\n    for (var i = 0; i < meta.data.length; i++) {\n      var element = meta.data[i],\n        view = element._view, text;\n\n      if (!this.shouldRenderData(view)) {\n        continue;\n      }\n      switch (this.render) {\n        case 'value':\n          var value = dataset.data[i];\n          if (this.format) {\n            value = this.format(value);\n          }\n          text = value.toString();\n          break;\n        case 'label':\n          text = chartInstance.config.data.labels[i];\n          break;\n        case 'image':\n          text = this.images[i] ? this.loadImage(this.images[i]) : '';\n          break;\n        case 'percentage':\n        default:\n          percentage = this.getPercentage(view, dataset, i);\n          text = percentage + '%';\n          break;\n      }\n      if (typeof this.render === 'function') {\n        text = this.render({\n          label: chartInstance.config.data.labels[i],\n          value: dataset.data[i],\n          percentage: percentage,\n          dataset: dataset,\n          index: i\n        });\n\n        if (text === null || text === undefined) {\n          text = '';\n        } else if (typeof text === 'object') {\n          text = this.loadImage(text);\n        } else {\n          text = text.toString();\n        }\n      }\n      if (!text) {\n        continue;\n      }\n      ctx.save();\n      ctx.beginPath();\n      ctx.font = Chart.helpers.fontString(this.fontSize, this.fontStyle, this.fontFamily);\n      var position, innerRadius, arcOffset = 0;\n      if (this.position === 'outside' || this.position === 'border') {\n        innerRadius = view.outerRadius / 2;\n        var rangeFromCentre, offset = this.fontSize + this.textMargin,\n          centreAngle = view.startAngle + ((view.endAngle - view.startAngle) / 2);\n        if (this.position === 'border') {\n          rangeFromCentre = (view.outerRadius - innerRadius) / 2 + innerRadius;\n        } else if (this.position === 'outside') {\n          if (!this.arc) {\n            offset = this.textMargin;\n          }\n          rangeFromCentre = (view.outerRadius - innerRadius) + innerRadius + offset;\n        }\n        position = {\n          x: view.x + (Math.cos(centreAngle) * rangeFromCentre),\n          y: view.y + (Math.sin(centreAngle) * rangeFromCentre)\n        };\n        if (this.position === 'outside') {\n          if (!this.arc) {\n            offset += (this.measureText(text).width / 2);\n          }\n          if (position.x < view.x) {\n            position.x -= offset;\n          } else {\n            position.x += offset;\n          }\n          arcOffset = view.outerRadius + offset;\n        }\n      } else {\n        innerRadius = view.innerRadius;\n        position = element.tooltipPosition();\n      }\n\n      var fontColor = this.fontColor;\n      if (typeof fontColor === 'function') {\n        fontColor = fontColor({\n          label: chartInstance.config.data.labels[i],\n          value: dataset.data[i],\n          percentage: percentage,\n          text: text,\n          backgroundColor: dataset.backgroundColor[i],\n          dataset: dataset,\n          index: i\n        });\n      } else if (typeof fontColor !== 'string') {\n        fontColor = fontColor[i] || this.options.defaultFontColor;\n      }\n      if (this.arc) {\n        if (!arcOffset) {\n          arcOffset = (innerRadius + view.outerRadius) / 2;\n        }\n        ctx.fillStyle = fontColor;\n        ctx.textBaseline = 'middle';\n        this.drawArcText(text, arcOffset, view, this.overlap);\n      } else {\n        var drawable, mertrics = this.measureText(text),\n          left = position.x - mertrics.width / 2,\n          right = position.x + mertrics.width / 2,\n          top = position.y - mertrics.height / 2,\n          bottom = position.y + mertrics.height / 2;\n        if (this.overlap) {\n          drawable = true;\n        } else if (this.position === 'outside') {\n          drawable = this.checkTextBound(left, right, top, bottom);\n        } else {\n          drawable = element.inRange(left, top) && element.inRange(left, bottom) &&\n            element.inRange(right, top) && element.inRange(right, bottom);\n        }\n        if (drawable) {\n          this.fillText(text, position, fontColor);\n        }\n      }\n      ctx.restore();\n    }\n  };\n\n  PieceLabel.prototype.shouldRenderData = function (view) {\n    //Skips label creation if value is zero and showZero is set\n    return this.chartInstance.config.type === 'polarArea' ? view.outerRadius !== 0 : view.circumference !== 0 || this.showZero;\n  };\n\n  PieceLabel.prototype.getPercentage = function (view, dataset, index) {\n    var percentage;\n    if (this.chartInstance.config.type === 'polarArea') {\n      if (this.total === null) {\n        this.total = 0;\n        for (var i = 0;i < dataset.data.length; ++i) {\n          this.total += dataset.data[i];\n        }\n      }\n      percentage = dataset.data[index] / this.total * 100;\n    } else {\n      percentage = view.circumference / this.options.circumference * 100;\n    }\n    percentage = parseFloat(percentage.toFixed(this.precision));\n    if (!this.showActualPercentages) {\n      this.totalPercentage += percentage;\n      if (this.totalPercentage > 100) {\n        percentage -= this.totalPercentage - 100;\n        // After adjusting the percentage, need to trim the numbers after decimal points again, otherwise it may not show\n        // on chart due to very long number after decimal point.\n        percentage = parseFloat(percentage.toFixed(this.precision));\n      }\n    }\n    return percentage;\n  };\n\n  PieceLabel.prototype.parseOptions = function (chartInstance, index) {\n    var pieceLabel = chartInstance.options.pieceLabel;\n    if (Array.isArray(pieceLabel)) {\n      pieceLabel = pieceLabel[index];\n    }\n    this.chartInstance = chartInstance;\n    this.ctx = chartInstance.chart.ctx;\n    this.options = chartInstance.config.options;\n    this.render = pieceLabel.render || pieceLabel.mode;\n    this.position = pieceLabel.position || 'default';\n    this.arc = pieceLabel.arc;\n    this.format = pieceLabel.format;\n    this.precision = pieceLabel.precision || 0;\n    this.fontSize = pieceLabel.fontSize || this.options.defaultFontSize;\n    this.fontColor = pieceLabel.fontColor || this.options.defaultFontColor;\n    this.fontStyle = pieceLabel.fontStyle || this.options.defaultFontStyle;\n    this.fontFamily = pieceLabel.fontFamily || this.options.defaultFontFamily;\n    this.shadowOffsetX = pieceLabel.shadowOffsetX || 3;\n    this.shadowOffsetY = pieceLabel.shadowOffsetY || 3;\n    this.shadowColor = pieceLabel.shadowColor || 'rgba(0,0,0,0.3)';\n    this.shadowBlur = pieceLabel.shadowBlur || 6;\n    this.textShadow = pieceLabel.textShadow || false;\n    this.hasTooltip = chartInstance.tooltip._active && chartInstance.tooltip._active.length;\n    this.showZero = pieceLabel.showZero;\n    this.overlap = pieceLabel.overlap;\n    this.images = pieceLabel.images || [];\n    this.outsidePadding = pieceLabel.outsidePadding || 2;\n    this.textMargin = pieceLabel.textMargin || 2;\n    this.showActualPercentages = pieceLabel.showActualPercentages || false;\n  };\n\n  PieceLabel.prototype.checkTextBound = function (left, right, top, bottom) {\n    var labelBounds = this.labelBounds;\n    for (var i = 0;i < labelBounds.length;++i) {\n      var bound = labelBounds[i];\n      var potins = [\n        [left, top],\n        [left, bottom],\n        [right, top],\n        [right, bottom]\n      ];\n      for (var j = 0;j < potins.length;++j) {\n        var x = potins[j][0];\n        var y = potins[j][1];\n        if (x >= bound.left && x <= bound.right && y >= bound.top && y <= bound.bottom) {\n          return false;\n        }\n      }\n      potins = [\n        [bound.left, bound.top],\n        [bound.left, bound.bottom],\n        [bound.right, bound.top],\n        [bound.right, bound.bottom]\n      ];\n      for (var j = 0;j < potins.length;++j) {\n        var x = potins[j][0];\n        var y = potins[j][1];\n        if (x >= left && x <= right && y >= top && y <= bottom) {\n          return false;\n        }\n      }\n    }\n    labelBounds.push({\n      left: left,\n      right: right,\n      top: top,\n      bottom: bottom\n    });\n    return true;\n  };\n\n  PieceLabel.prototype.measureText = function (text) {\n    if (typeof text === 'object') {\n      return { width: text.width, height: text.height };\n    } else {\n      var width = 0;\n      var lines = text.split('\\n');\n      for (var i = 0; i < lines.length; ++i) {\n        var result = this.ctx.measureText(lines[i]);\n        if (result.width > width) {\n          width = result.width;\n        }\n      }\n      return { width: width, height: this.fontSize * lines.length };\n    }\n  };\n\n  PieceLabel.prototype.fillText = function (text, position, fontColor) {\n    var ctx = this.ctx;\n    if (typeof text === 'object') {\n      ctx.drawImage(text, position.x - text.width / 2, position.y - text.height / 2, text.width, text.height);\n    } else {\n      ctx.save();\n      ctx.fillStyle = fontColor;\n      ctx.textBaseline = 'top';\n      ctx.textAlign = 'center';\n\n      if (this.textShadow) {\n        ctx.shadowOffsetX = this.shadowOffsetX;\n        ctx.shadowOffsetY = this.shadowOffsetY;\n        ctx.shadowColor = this.shadowColor;\n        ctx.shadowBlur = this.shadowBlur;\n      }\n\n      var lines = text.split('\\n');\n      for (var i = 0; i < lines.length; i++) {\n        var y = position.y - this.fontSize / 2 * lines.length + this.fontSize * i;\n        ctx.fillText(lines[i], position.x, y);\n      }\n      ctx.restore();\n    }\n  };\n\n  PieceLabel.prototype.loadImage = function (obj) {\n    var image = new Image();\n    image.src = obj.src;\n    image.width = obj.width;\n    image.height = obj.height;\n    return image;\n  };\n\n  PieceLabel.prototype.drawArcText = function (str, radius, view, overlap) {\n    var ctx = this.ctx,\n      centerX = view.x,\n      centerY = view.y,\n      startAngle = view.startAngle,\n      endAngle = view.endAngle;\n\n    ctx.save();\n    ctx.translate(centerX, centerY);\n    ctx.textAlign = 'left';\n    var angleSize = endAngle - startAngle;\n    startAngle += Math.PI / 2;\n    endAngle += Math.PI / 2;\n    var origStartAngle = startAngle;\n    var mertrics = this.measureText(str);\n    startAngle += (endAngle - (mertrics.width / radius + startAngle)) / 2;\n    if (!overlap && endAngle - startAngle > angleSize) {\n      ctx.restore();\n      return;\n    }\n\n    if (typeof str === 'string') {\n      ctx.rotate(startAngle);\n      var lines = str.split('\\n'), max = 0, widths = [], offset = 0;\n      if (this.position === 'border') {\n        offset = (lines.length - 1) * this.fontSize / 2;\n      }\n      for (var j = 0; j < lines.length; ++j) {\n        var mertrics = ctx.measureText(lines[j]);\n        if (mertrics.width > max) {\n          max = mertrics.width;\n        }\n        widths.push(mertrics.width);\n      }\n      for (var j = 0; j < lines.length; ++j) {\n        var line = lines[j];\n        var y = (lines.length - 1 - j) * -this.fontSize + offset;\n        ctx.save();\n        var padding = (max - widths[j]) / 2;\n        ctx.rotate(padding / radius);\n        for (var i = 0; i < line.length; i++) {\n          var char = line.charAt(i);\n          mertrics = ctx.measureText(char);\n          ctx.save();\n          ctx.translate(0, -1 * radius);\n          ctx.fillText(char, 0, y);\n          ctx.restore();\n          ctx.rotate(mertrics.width / radius);\n        }\n        ctx.restore();\n      }\n    } else {\n      ctx.rotate((origStartAngle + endAngle) / 2);\n      ctx.translate(0, -1 * radius);\n      this.fillText(str, { x: 0, y: 0 });\n    }\n    ctx.restore();\n  };\n\n  function init(chartInstance) {\n    if (chartInstance.options.pieceLabel) {\n      var count = 1;\n      if (Array.isArray(chartInstance.options.pieceLabel)) {\n        count = chartInstance.options.pieceLabel.length;\n      }\n      if (!chartInstance.pieceLabel || count !== chartInstance.pieceLabel.length) {\n        chartInstance.pieceLabel = [];\n        for (var i = 0; i < count; ++i) {\n          chartInstance.pieceLabel.push(new PieceLabel());\n        }\n      }\n    } else if (chartInstance.pieceLabel) {\n      delete chartInstance.pieceLabel;\n    }\n    return chartInstance.pieceLabel;\n  }\n\n  function execute(chartInstance, method) {\n    if (init(chartInstance)) {\n      for (var i = 0; i < chartInstance.pieceLabel.length; ++i) {\n        chartInstance.pieceLabel[i][method](chartInstance, i);\n      }\n    }\n  }\n\n  Chart.pluginService.register({\n    name: 'PieceLabel',\n    beforeDatasetsUpdate: function (chartInstance) {\n      execute(chartInstance, 'beforeDatasetsUpdate');\n    },\n    afterDatasetsDraw: function (chartInstance) {\n      execute(chartInstance, 'afterDatasetsDraw');\n    }\n  });\n})();\n"]},"metadata":{},"sourceType":"script"}